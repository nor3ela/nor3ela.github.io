(function() {
    'use strict';

    var themes = {
        default: '.activity__loader{position:absolute;top:0;left:0;width:100%;height:100%;display:none;background:url("data:image/svg+xml,${svgCode}") no-repeat 50% 50%}',
        violet_stroke: ':root{--main-color:#8B29B9;--background-color:#1d1f20;--text-color:#fff;--transparent-white:rgba(255,255,255,.2)}body{background-color:#1d1f20;color:#fff}.menu__ico{color:#000;-webkit-filter:invert(1);filter:invert(1)}.activity__loader{position:absolute;top:0;left:0;width:100%;height:100%;display:none;background:url("data:image/svg+xml,${svgCode}") no-repeat 50% 50%}.modal-loading{height:6em;-webkit-background-size:contain;-moz-background-size:contain;-o-background-size:contain;background-size:contain}.console__tab.focus,.menu__item.focus,.menu__item.traverse,.menu__item.hover,.full-person.focus,.full-start__button.focus,.full-descr__tag.focus,.simple-button.focus,.head__action.focus,.head__action.hover,.player-panel .button.focus,.search-source.active{background:#8B29B9;color:#fff}.navigation-tabs__button.focus,.time-line>div,.player-panel__position,.player-panel__position>div:after{background-color:#8B29B9;color:#fff}.iptv-menu__list-item.focus,.iptv-program__timeline>div{background-color:#8B29B9!important;color:#fff!important}.radio-item.focus,.lang__selector-item.focus,.simple-keyboard .hg-button.focus,.modal__button.focus,.search-history-key.focus,.simple-keyboard-mic.focus,.torrent-serial__progress,.full-review-add.focus,.full-review.focus,.tag-count.focus,.settings-folder.focus,.settings-param.focus,.selectbox-item.focus,.selectbox-item.hover{background:#8B29B9;color:#fff}.online.focus{box-shadow:0 0 0 .2em #8B29B9}.online_modss.focus::after,.online-prestige.focus::after,.radio-item.focus .radio-item__imgbox:after,.iptv-channel.focus::before,.iptv-channel.last--focus::before{border-color:#8B29B9!important}.card-more.focus .card-more__box::after{border:.3em solid #8B29B9}.simple-button--filter>div{background-color:rgba(255,255,255,.1)}.iptv-playlist-item.focus::after,.iptv-playlist-item.hover::after{border-color:#8B29B9!important}.ad-bot.focus .ad-bot__content::after,.ad-bot.hover .ad-bot__content::after,.card-episode.focus .full-episode::after,.register.focus::after,.season-episode.focus::after,.full-episode.focus::after,.full-review-add.focus::after,.card.focus .card__view::after,.card.hover .card__view::after,.extensions__item.focus:after,.torrent-item.focus::after,.extensions__block-add.focus:after{border-color:#8B29B9}.items-line__more{background:rgba(255,255,255,.1)}.items-line__more.focus{background:#8B29B9!important;color:#fff!important}.torrent-serial__size{background-color:#fff;color:#000}.broadcast__scan>div,.broadcast__device.focus{background-color:#8B29B9;color:#fff}.card:hover .card__img,.card.focus .card__img{border-color:#8B29B9}.noty{background:#8B29B9;color:#fff}.radio-player.focus{background-color:#8B29B9;color:#fff}.explorer-card__head-img.focus::after{border:.3em solid #8B29B9}',
        neon_mod: ':root{--main-color:#e13fe4;--secondary-color:#9d61d3;--background-color:rgba(15,2,33,.95);--text-color:#fff;--transparent-accent:rgba(225,63,228,.1)}body{background:linear-gradient(135deg,#0d0221 0%,#150734 50%,#1f0c47 100%);color:#fff}.menu__ico{color:#000;-webkit-filter:invert(1);filter:invert(1)}.activity__loader{position:absolute;top:0;left:0;width:100%;height:100%;display:none;background:url("data:image/svg+xml,${svgCode}") no-repeat 50% 50%}.modal-loading{height:6em;-webkit-background-size:contain;-moz-background-size:contain;-o-background-size:contain;background-size:contain}.console__tab.focus,.menu__item.focus,.menu__item.traverse,.menu__item.hover,.full-person.focus,.full-start__button.focus,.full-descr__tag.focus,.simple-button.focus,.head__action.focus,.head__action.hover,.player-panel .button.focus,.search-source.active,.navigation-tabs__button.focus,.radio-item.focus,.lang__selector-item.focus,.simple-keyboard .hg-button.focus,.modal__button.focus,.search-history-key.focus,.simple-keyboard-mic.focus,.torrent-serial__progress,.full-review-add.focus,.full-review.focus,.tag-count.focus,.settings-folder.focus,.settings-param.focus,.selectbox-item.focus,.selectbox-item.hover,.radio-player.focus,.broadcast__device.focus{background:linear-gradient(to right,#e13fe4,#9d61d3);color:#fff;box-shadow:0 0 10px rgba(225,63,228,.2);text-shadow:0 0 10px rgba(255,255,255,.5);border:none}.time-line>div,.player-panel__position,.player-panel__position>div:after,.iptv-menu__list-item.focus,.iptv-program__timeline>div,.broadcast__scan>div{background-color:#e13fe4;color:#fff}.card.focus .card__view::after,.card.hover .card__view::after{border:3px solid #e13fe4!important;box-shadow:0 0 10px rgba(225,63,228,.2)}.online.focus{border:3px solid #e13fe4!important;box-shadow:0 0 10px rgba(225,63,228,.2)}.online_modss.focus::after,.online-prestige.focus::after,.radio-item.focus .radio-item__imgbox:after,.iptv-channel.focus::before,.iptv-channel.last--focus::before,.iptv-playlist-item.focus::after,.iptv-playlist-item.hover::after,.ad-bot.focus .ad-bot__content::after,.ad-bot.hover .ad-bot__content::after,.card-episode.focus .full-episode::after,.register.focus::after,.season-episode.focus::after,.full-episode.focus::after,.full-review-add.focus::after,.extensions__item.focus:after,.torrent-item.focus::after,.extensions__block-add.focus:after,.card-more.focus .card-more__box::after,.explorer-card__head-img.focus::after{border:3px solid #e13fe4!important;box-shadow:0 0 10px rgba(225,63,228,.2)}.items-line__more{background:rgba(225,63,228,.1)}.items-line__more.focus{background:linear-gradient(to right,#e13fe4,#9d61d3)!important;color:#fff!important;box-shadow:0 0 10px rgba(225,63,228,.2)}.simple-button--filter>div{background-color:rgba(225,63,228,.1)}.torrent-serial__size{background-color:#fff;color:#000}.noty{background:linear-gradient(to right,#e13fe4,#9d61d3);color:#fff}.full-start__background{opacity:.7;filter:brightness(1.2) saturate(1.3)}.settings__content,.settings-input__content,.selectbox__content,.modal__content,.lang{background:rgba(15,2,33,.95) !important;border:1px solid rgba(225,63,228,.1) !important;box-shadow:0 0 10px rgba(225,63,228,.1) !important}',
        emerald: ':root{--main-color:#43cea2;--secondary-color:#185a9d;--background-color:rgba(26,42,58,.98);--text-color:#fff;--transparent-accent:rgba(67,206,162,.1)}body{background:linear-gradient(135deg,#1a2a3a 0%,#2C5364 50%,#203A43 100%);color:#fff}.menu__ico{color:#000;-webkit-filter:invert(1);filter:invert(1)}.activity__loader{position:absolute;top:0;left:0;width:100%;height:100%;display:none;background:url("data:image/svg+xml,${svgCode}") no-repeat 50% 50%}.modal-loading{height:6em;-webkit-background-size:contain;-moz-background-size:contain;-o-background-size:contain;background-size:contain}.console__tab.focus,.menu__item.focus,.menu__item.traverse,.menu__item.hover,.full-person.focus,.full-start__button.focus,.full-descr__tag.focus,.simple-button.focus,.head__action.focus,.head__action.hover,.player-panel .button.focus,.search-source.active,.navigation-tabs__button.focus,.radio-item.focus,.lang__selector-item.focus,.simple-keyboard .hg-button.focus,.modal__button.focus,.search-history-key.focus,.simple-keyboard-mic.focus,.torrent-serial__progress,.full-review-add.focus,.full-review.focus,.tag-count.focus,.settings-folder.focus,.settings-param.focus,.selectbox-item.focus,.selectbox-item.hover,.radio-player.focus,.broadcast__device.focus{background:linear-gradient(to right,#43cea2,#185a9d);color:#fff;box-shadow:0 4px 15px rgba(67,206,162,.3)}.time-line>div,.player-panel__position,.player-panel__position>div:after,.iptv-menu__list-item.focus,.iptv-program__timeline>div,.broadcast__scan>div{background-color:#43cea2;color:#fff}.card.focus .card__view::after,.card.hover .card__view::after{border:3px solid #43cea2!important;box-shadow:0 0 20px rgba(67,206,162,.4)}.online.focus{border:3px solid #43cea2!important;box-shadow:0 0 20px rgba(67,206,162,.4)}.online_modss.focus::after,.online-prestige.focus::after,.radio-item.focus .radio-item__imgbox:after,.iptv-channel.focus::before,.iptv-channel.last--focus::before,.iptv-playlist-item.focus::after,.iptv-playlist-item.hover::after,.ad-bot.focus .ad-bot__content::after,.ad-bot.hover .ad-bot__content::after,.card-episode.focus .full-episode::after,.register.focus::after,.season-episode.focus::after,.full-episode.focus::after,.full-review-add.focus::after,.extensions__item.focus:after,.torrent-item.focus::after,.extensions__block-add.focus:after,.card-more.focus .card-more__box::after,.explorer-card__head-img.focus::after{border:3px solid #43cea2!important;box-shadow:0 0 20px rgba(67,206,162,.4)}.items-line__more{background:rgba(67,206,162,.1)}.items-line__more.focus{background:linear-gradient(to right,#43cea2,#185a9d)!important;color:#fff!important;box-shadow:0 4px 15px rgba(67,206,162,.3)}.simple-button--filter>div{background-color:rgba(67,206,162,.1)}.torrent-serial__size{background-color:#fff;color:#000}.noty{background:linear-gradient(to right,#43cea2,#185a9d);color:#fff}.full-start__background{opacity:.85;filter:brightness(1.1) saturate(1.2)}.settings__content,.settings-input__content,.selectbox__content,.modal__content,.lang{background:rgba(26,42,58,.98) !important;border:1px solid rgba(67,206,162,.1) !important;box-shadow:0 0 20px rgba(67,206,162,.1) !important}',
    	flix: ':root{--main-color:#E50914;--secondary-color:#B20710;--background-color:#141414;--text-color:#FFFFFF;--transparent-accent:rgba(229, 9, 20, 0.15)}body{background:linear-gradient(135deg,#141414 0,#1a1a1a 50%,#0f0f0f 100%);color:var(--text-color)}.menu__ico{color:#000;-webkit-filter:invert(1);filter:invert(1)}.activity__loader{position:absolute;top:0;left:0;width:100%;height:100%;display:none;background:url("data:image/svg+xml,${svgCode}") 50% 50% no-repeat}.modal-loading{height:6em;-webkit-background-size:contain;-moz-background-size:contain;-o-background-size:contain;background-size:contain}.broadcast__device.focus,.console__tab.focus,.full-descr__tag.focus,.full-person.focus,.full-review-add.focus,.full-review.focus,.full-start__button.focus,.head__action.focus,.head__action.hover,.lang__selector-item.focus,.menu__item.focus,.menu__item.hover,.menu__item.traverse,.modal__button.focus,.navigation-tabs__button.focus,.player-panel .button.focus,.radio-item.focus,.radio-player.focus,.search-history-key.focus,.search-source.active,.selectbox-item.focus,.selectbox-item.hover,.settings-folder.focus,.settings-param.focus,.simple-button.focus,.simple-keyboard .hg-button.focus,.simple-keyboard-mic.focus,.tag-count.focus,.torrent-serial__progress{background:linear-gradient(to right,var(--main-color),var(--secondary-color));color:var(--text-color);box-shadow:0 4px 12px rgba(229,9,20,.4);border:none;transition:.2s}.broadcast__scan>div,.iptv-menu__list-item.focus,.iptv-program__timeline>div,.player-panel__position,.player-panel__position>div:after,.time-line>div{background-color:var(--main-color);color:var(--text-color)}.ad-bot.focus .ad-bot__content::after,.ad-bot.hover .ad-bot__content::after,.card-episode.focus .full-episode::after,.card-more.focus .card-more__box::after,.card.focus .card__view::after,.card.hover .card__view::after,.explorer-card__head-img.focus::after,.extensions__block-add.focus:after,.extensions__item.focus:after,.full-episode.focus::after,.full-review-add.focus::after,.iptv-channel.focus::before,.iptv-channel.last--focus::before,.iptv-playlist-item.focus::after,.iptv-playlist-item.hover::after,.online-prestige.focus::after,.online.focus,.online_modss.focus::after,.radio-item.focus .radio-item__imgbox:after,.register.focus::after,.season-episode.focus::after,.torrent-item.focus::after{border:3px solid var(--main-color)!important;box-shadow:0 0 15px rgba(229,9,20,.5)}.items-line__more{background:var(--transparent-accent);transition:background .2s}.items-line__more.focus{background:linear-gradient(to right,var(--main-color),var(--secondary-color))!important;color:var(--text-color)!important;box-shadow:0 4px 12px rgba(229,9,20,.4)}.simple-button--filter>div{background-color:var(--transparent-accent)}.torrent-serial__size{background-color:var(--text-color);color:#000}.noty{background:linear-gradient(to right,var(--main-color),var(--secondary-color));color:var(--text-color)}.full-start__background{opacity:.9;filter:brightness(1.15) saturate(1.3)}.lang,.modal__content,.selectbox__content,.settings-input__content,.settings__content{background:rgba(20,20,20,.95)!important;border:1px solid var(--transparent-accent)!important;box-shadow:0 0 15px rgba(229,9,20,.2)!important}',
        pulse: ':root{--main-color:#00DDEB;--secondary-color:#D800FF;--background-color:#0A0B1A;--text-color:#FFFFFF;--transparent-accent:rgba(0, 221, 235, 0.15)}body{background:linear-gradient(135deg,#0a0b1a 0,#1a1b2f 50%,#0f1023 100%);color:var(--text-color)}.menu__ico{color:#000;-webkit-filter:invert(1);filter:invert(1)}.activity__loader{position:absolute;top:0;left:0;width:100%;height:100%;display:none;background:url("data:image/svg+xml,${svgCode}") 50% 50% no-repeat}.modal-loading{height:6em;-webkit-background-size:contain;-moz-background-size:contain;-o-background-size:contain;background-size:contain}.broadcast__device.focus,.console__tab.focus,.full-descr__tag.focus,.full-person.focus,.full-review-add.focus,.full-review.focus,.full-start__button.focus,.head__action.focus,.head__action.hover,.lang__selector-item.focus,.menu__item.focus,.menu__item.hover,.menu__item.traverse,.modal__button.focus,.navigation-tabs__button.focus,.player-panel .button.focus,.radio-item.focus,.radio-player.focus,.search-history-key.focus,.search-source.active,.selectbox-item.focus,.selectbox-item.hover,.settings-folder.focus,.settings-param.focus,.simple-button.focus,.simple-keyboard .hg-button.focus,.simple-keyboard-mic.focus,.tag-count.focus,.torrent-serial__progress{background:linear-gradient(to right,var(--main-color),var(--secondary-color));color:var(--text-color);box-shadow:0 0 12px rgba(0,221,235,.5);border:none;transition:.3s}.broadcast__scan>div,.iptv-menu__list-item.focus,.iptv-program__timeline>div,.noty,.player-panel__position,.player-panel__position>div:after,.time-line>div{background:linear-gradient(to right,var(--main-color),var(--secondary-color));color:var(--text-color)}.ad-bot.focus .ad-bot__content::after,.ad-bot.hover .ad-bot__content::after,.card-episode.focus .full-episode::after,.card-more.focus .card-more__box::after,.card.focus .card__view::after,.card.hover .card__view::after,.explorer-card__head-img.focus::after,.extensions__block-add.focus:after,.extensions__item.focus:after,.full-episode.focus::after,.full-review-add.focus::after,.iptv-channel.focus::before,.iptv-channel.last--focus::before,.iptv-playlist-item.focus::after,.iptv-playlist-item.hover::after,.online-prestige.focus::after,.online.focus,.online_modss.focus::after,.radio-item.focus .radio-item__imgbox:after,.register.focus::after,.season-episode.focus::after,.torrent-item.focus::after{border:3px solid var(--main-color)!important;box-shadow:0 0 15px rgba(0,221,235,.6)}.items-line__more{background:var(--transparent-accent);transition:background .3s}.items-line__more.focus{background:linear-gradient(to right,var(--main-color),var(--secondary-color))!important;color:var(--text-color)!important;box-shadow:0 0 12px rgba(0,221,235,.5)}.simple-button--filter>div{background-color:var(--transparent-accent)}.torrent-serial__size{background-color:var(--text-color);color:#000}.full-start__background{opacity:.85;filter:brightness(1.2) saturate(1.4)}.lang,.modal__content,.selectbox__content,.settings-input__content,.settings__content{background:rgba(10,11,26,.95)!important;border:1px solid var(--transparent-accent)!important;box-shadow:0 0 12px rgba(0,221,235,.3)!important}',
    };

    var loaderColors = {
        default: '#fff',
        violet_stroke: '#8B29B9',
        neon_mod: '#e13fe4',
        emerald: '#43cea2'
    };

    function applyTheme(theme) {
        var oldStyle = document.querySelector('#interface_theme_mod_style');
        if (oldStyle) {
            oldStyle.parentNode.removeChild(oldStyle);
        }

        var style = document.createElement('style');
        style.id = 'interface_theme_mod_style';
        var color = loaderColors[theme] || loaderColors.default;
        var svgCode = encodeURIComponent(
            `<svg xmlns="http://www.w3.org/2000/svg" width="135" height="140" fill="${color}"><rect width="15" height="120" y="10" rx="6"><animate attributeName="height" begin="0.5s" calcMode="linear" dur="1s" repeatCount="indefinite" values="120;110;100;90;80;70;60;50;40;140;120"/><animate attributeName="y" begin="0.5s" calcMode="linear" dur="1s" repeatCount="indefinite" values="10;15;20;25;30;35;40;45;50;0;10"/></rect><rect width="15" height="120" x="30" y="10" rx="6"><animate attributeName="height" begin="0.25s" calcMode="linear" dur="1s" repeatCount="indefinite" values="120;110;100;90;80;70;60;50;40;140;120"/><animate attributeName="y" begin="0.25s" calcMode="linear" dur="1s" repeatCount="indefinite" values="10;15;20;25;30;35;40;45;50;0;10"/></rect><rect width="15" height="140" x="60" rx="6"><animate attributeName="height" begin="0s" calcMode="linear" dur="1s" repeatCount="indefinite" values="120;110;100;90;80;70;60;50;40;140;120"/><animate attributeName="y" begin="0s" calcMode="linear" dur="1s" repeatCount="indefinite" values="10;15;20;25;30;35;40;45;50;0;10"/></rect><rect width="15" height="120" x="90" y="10" rx="6"><animate attributeName="height" begin="0.25s" calcMode="linear" dur="1s" repeatCount="indefinite" values="120;110;100;90;80;70;60;50;40;140;120"/><animate attributeName="y" begin="0.25s" calcMode="linear" dur="1s" repeatCount="indefinite" values="10;15;20;25;30;35;40;45;50;0;10"/></rect><rect width="15" height="120" x="120" y="10" rx="6"><animate attributeName="height" begin="0.5s" calcMode="linear" dur="1s" repeatCount="indefinite" values="120;110;100;90;80;70;60;50;40;140;120"/><animate attributeName="y" begin="0.5s" calcMode="linear" dur="1s" repeatCount="indefinite" values="10;15;20;25;30;35;40;45;50;0;10"/></rect></svg>`
        );
        style.textContent = themes[theme].replace('${svgCode}', svgCode);
        document.head.appendChild(style);

        console.log('Theme applied:', theme, 'Loader color:', color);
        console.log('SVG length:', decodeURIComponent(svgCode).length);
    }

    function initPlugin() {
        var defaultTheme = 'default';
        var savedTheme = Lampa.Storage.get('interface_theme', defaultTheme);

        if (!themes[savedTheme]) {
            savedTheme = defaultTheme;
            Lampa.Storage.set('interface_theme', defaultTheme);
        }

        applyTheme(savedTheme);

        Lampa.SettingsApi.addParam({
            component: 'interface',
            param: {
                name: 'interface_theme',
                type: 'select',
                values: {
                    default: 'Стандартная',
                    violet_stroke: 'Фиолетовая',
                    neon_mod: 'Neon Mod',
                    emerald: 'Emerald',
                    pulse: 'Pulse',
                    flix: 'Flix',
                },
                default: defaultTheme
            },
            field: {
                name: 'Тема интерфейса',
                description: 'Измените внешний вид интерфейса'
            },
            onChange: function(value) {
                Lampa.Storage.set('interface_theme', value);
                Lampa.Settings.update();
                applyTheme(value);
            },
            onRender: function(item) {
                setTimeout(function() {
                    $('div[data-name="interface_theme"]').insertBefore('div[data-name="interface_size"]');
                }, 0);
            }
        });
    }

    if (window.appready) {
        initPlugin();
    } else {
        Lampa.Listener.follow('app', function(e) {
            if (e.type === 'ready') {
                initPlugin();
            }
        });
    }
})();